# 테스트 전략

> 무엇을, 어떻게, 언제 테스트할 것인가

## 테스트 피라미드

```
        /\
       /  \      E2E (Playwright)
      /----\     - 핵심 사용자 플로우
     /      \    - 크리티컬 패스
    /--------\
   /          \  통합 테스트
  /            \ - API 연동
 /--------------\
/                \ 단위 테스트
------------------  - 개별 함수/컴포넌트
```

**우리의 범위**: E2E 테스트 (Playwright)

---

## 테스트 범위 결정

### 반드시 테스트해야 하는 것 (P0)

1. **핵심 사용자 플로우**
   - 회원가입 → 로그인 → 상품 조회 → 결제
   - 이 플로우가 깨지면 서비스 불가

2. **돈과 관련된 기능**
   - 결제 프로세스
   - 환불 프로세스
   - 쿠폰/포인트 적용

3. **인증/보안**
   - 로그인/로그아웃
   - 권한 체크

### 테스트하면 좋은 것 (P1-P2)

1. **자주 변경되는 기능**
   - 리그레션 방지

2. **버그가 자주 발생하는 영역**
   - 과거 이슈 기반

3. **복잡한 비즈니스 로직**
   - 조건부 UI
   - 상태 의존적 기능

### 테스트 안 해도 되는 것

1. **외부 서비스 UI**
   - PG사 결제창 내부
   - 소셜 로그인 제공자 화면

2. **단순 정적 페이지**
   - 회사 소개, 이용약관

3. **관리자 전용 기능** (리소스 한정 시)

---

## 테스트 유형

### 1. 스모크 테스트 (Smoke Test)

**목적**: 배포 후 기본 기능 동작 확인
**실행 시점**: 매 배포 후
**소요 시간**: 5분 이내
**범위**:
- [ ] 메인 페이지 로드
- [ ] 로그인 가능
- [ ] 상품 목록 조회
- [ ] 결제 페이지 접근

```bash
npm test -- --grep "@smoke"
```

### 2. 회귀 테스트 (Regression Test)

**목적**: 기존 기능이 깨지지 않았는지 확인
**실행 시점**: PR 머지 전, 매일 자정
**소요 시간**: 30분 이내
**범위**: 전체 테스트

```bash
npm test
```

### 3. 탐색적 테스트 (Exploratory Test)

**목적**: 자동화하기 어려운 영역 수동 검증
**실행 시점**: 스프린트 종료 전
**방법**: 시나리오 없이 자유롭게 탐색

---

## 환경 전략

| 환경 | URL | 테스트 범위 | 실행 |
|------|-----|------------|------|
| Local | localhost:3000 | 개발 중 기능 | 수동 |
| Staging | staging.example.com | 전체 | 자동 (CI) |
| Production | example.com | 스모크만 | 배포 후 |

### 환경별 데이터

- **Staging**: 테스트 전용 계정, 테스트 상품
- **Production**: 읽기 전용 테스트 (주문 X)

---

## 테스트 작성 우선순위

### Phase 1: 핵심 플로우 (1-2주)

1. 로그인/로그아웃
2. 상품 조회
3. 장바구니 추가
4. 주문 완료

### Phase 2: 에러 케이스 (2-3주)

1. 잘못된 입력 검증
2. 권한 없는 접근
3. 네트워크 에러 처리

### Phase 3: 엣지 케이스 (4주+)

1. 동시성 이슈
2. 브라우저 호환성
3. 모바일 반응형

---

## 테스트 유지보수

### 깨지기 쉬운 테스트 (Flaky Test) 대응

1. **재시도 설정**
```typescript
// playwright.config.ts
retries: 2,
```

2. **안정적인 로케이터 사용**
```typescript
// 나쁨: 클래스명 (자주 변경됨)
page.locator('.btn-primary')

// 좋음: 역할 기반
page.getByRole('button', { name: '로그인' })
```

3. **명시적 대기**
```typescript
await expect(element).toBeVisible();
await element.click();
```

### 테스트 정리 기준

- 3회 이상 연속 실패 → 원인 분석 필수
- 기능 삭제됨 → 테스트도 삭제
- 중복 테스트 → 하나로 통합

---

## 메트릭

### 추적 지표

| 지표 | 목표 | 현재 |
|------|------|------|
| 테스트 수 | 50+ | 14 |
| 성공률 | 95%+ | 100% |
| 실행 시간 | < 10분 | 3초 |
| P0 커버리지 | 100% | 0% |

### 주간 리뷰

- [ ] 새로 추가된 테스트 수
- [ ] 실패한 테스트 원인
- [ ] 플레이키 테스트 현황
- [ ] 커버리지 변화
